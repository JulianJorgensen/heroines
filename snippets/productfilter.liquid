{% comment %}
Product Filter by Zyber
https://apps.shopify.com/productfilter

Author:     Zac Bruce
Email:      z.bruce@zyber.co.nz / zac@tuft.co.nz
Support:    https://www.zyber.io/app-support

Files:
snippets/productfilter.liquid
assets/zproducts.js

snippets/productfilter.liquid
    The logic engine behind Product Filter.
    This file is changed with each new version released.

assets/zproducts.js
    Holds all product information shown from the Filter.
    Gets updated every time you add, change or remove any products.

Changelog (haphazardly updated):
https://s3-us-west-1.amazonaws.com/zyberlabs/productfilter/dev/changelog.txt
{% endcomment %}
<div id="pf__toggle"><button><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 206 204" xml:space="preserve"><g><path class="st0" d="M54.3,98.8c-2.5-13.7-0.7-28.3,6.2-41.6c16.6-32.4,56.3-45.2,88.7-28.7c13.3,6.8,23.3,17.6,29.4,30.2l20.4-6.6 c-7.8-17.7-21.5-33-40-42.5C116.1-12.3,63.5,4.7,41.6,47.5c-9.5,18.6-11.7,39-7.6,57.9L54.3,98.8z"></path><path class="st0" d="M205.1,72.4L184.6,79c1.6,12.7-0.5,25.9-6.7,38.1c-16.6,32.4-56.3,45.2-88.7,28.7c-12.2-6.2-21.6-15.8-27.8-27 l-20.5,6.6c2.6,5.3,5.7,10.4,9.4,15.1L1,189.8l15,15l49.2-49.2c4.4,3.4,9.1,6.5,14.2,9.1c42.8,21.9,95.4,4.9,117.3-37.9 C205.7,109.4,208.2,90.4,205.1,72.4z"></path></g></svg> <span></span></button></div><div id="pf__wrapper" style="display:none"><div id="pf__filters"><div class="pf__dismiss"><button><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Capa_1" x="0px" y="0px" width="348.333px" height="348.334px" viewBox="0 0 348.333 348.334" style="fill: rgb(255, 255, 255)" xml:space="preserve"><path d="M336.559,68.611L231.016,174.165l105.543,105.549c15.699,15.705,15.699,41.145,0,56.85   c-7.844,7.844-18.128,11.769-28.407,11.769c-10.296,0-20.581-3.919-28.419-11.769L174.167,231.003L68.609,336.563   c-7.843,7.844-18.128,11.769-28.416,11.769c-10.285,0-20.563-3.919-28.413-11.769c-15.699-15.698-15.699-41.139,0-56.85   l105.54-105.549L11.774,68.611c-15.699-15.699-15.699-41.145,0-56.844c15.696-15.687,41.127-15.687,56.829,0l105.563,105.554   L279.721,11.767c15.705-15.687,41.139-15.687,56.832,0C352.258,27.466,352.258,52.912,336.559,68.611z" style="fill: rgb(255, 255, 255)"></path></svg></button></div><div class="pf__show-results"><button>Show Results (<span></span>)</button></div><h1>Filter By</h1><div class="pf__section"><div class="pf__filter pf__search"><input type="text" class="pf__search-input" name="pfSearchInput" placeholder="Search" autocorrect="off" spellcheck="false"></div></div></div><div id="pf-results__wrapper"><div class="pf__dismiss"><button><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Capa_1" x="0px" y="0px" width="348.333px" height="348.334px" viewBox="0 0 348.333 348.334" style="fill: rgb(255, 255, 255)" xml:space="preserve"><path d="M336.559,68.611L231.016,174.165l105.543,105.549c15.699,15.705,15.699,41.145,0,56.85   c-7.844,7.844-18.128,11.769-28.407,11.769c-10.296,0-20.581-3.919-28.419-11.769L174.167,231.003L68.609,336.563   c-7.843,7.844-18.128,11.769-28.416,11.769c-10.285,0-20.563-3.919-28.413-11.769c-15.699-15.698-15.699-41.139,0-56.85   l105.54-105.549L11.774,68.611c-15.699-15.699-15.699-41.145,0-56.844c15.696-15.687,41.127-15.687,56.829,0l105.563,105.554   L279.721,11.767c15.705-15.687,41.139-15.687,56.832,0C352.258,27.466,352.258,52.912,336.559,68.611z" style="fill: rgb(255, 255, 255)"></path></svg></button></div><div class="pf__show-filters"><button>Change Filters</button></div><div id="pf-results__title"><h1>Filter Results <small>(<span></span>)</small><div id="pf-pagination__pages"></div></h1></div><div id="pf__results"></div><div id="pf__pagination"></div></div></div>
<script type="text/template" id="pf-template__section"><div class="pf__section"><div class="pf__filter-block"><label class="pf__group-title"></label></div></div></script><script type="text/template" id="pf-template__check"><div class="pf__filter"><input class="pf__check" type="checkbox" value=""><label class="pf__label"></label></div></script><script type="text/template" id="pf-template__range"><div class="pf__filter"><div class="pf__range"></div><input type="hidden" class="pf-range__input"></div></script><script type="text/template" id="pf-template__result"><div class="pf__result"><a href="/products/<%= handle %>"><div class="pf-result__image"><img src="<%= image %>"></div><div class="pf-result__detail"><div class="pf-detail__vendor"><%= vendor %></div><div class="pf-detail__title"><%= title %></div><div class="pf-detail__price"><%= variants[0].price %></div></div></a></div></script>
<style type="text/css" title="pf__stylesheet">
#pf__toggle button,#pf__wrapper button{border:none;cursor:pointer}#pf-results__wrapper,.pf__dismiss{position:absolute;top:0;right:0}#pf__toggle button{position:fixed;z-index:12000;font-size:1.2rem;padding:10px 20px;line-height:1;color:#fff}#pf__toggle button svg{display:inline-block;margin-right:10px;width:1.2rem;vertical-align:middle;fill:#fff}#pf__wrapper{position:fixed;top:0;right:0;bottom:0;left:0;background-color:#fff;z-index:11000}.pf__no-scroll{overflow:hidden}#pf__filters{background-color:#f6f6f6;padding:20px;min-width:20%;max-width:30%;width:340px;height:100%;position:relative;overflow-y:auto}.pf__dismiss button{padding:.8rem}.pf__dismiss button svg{width:2.2rem;height:2.2rem;vertical-align:middle;fill:#fff}#pf-results__title h1,#pf__filters h1{padding-bottom:1rem;font-size:3rem;border-bottom:2px solid #000}#pf__filters .pf__section{margin:0 0 1.2rem}#pf__filters .pf__search .pf__search-input{width:100%;background-color:#fff;color:#7a7a7a;font-size:1.2rem}#pf__filters label.pf__group-title{font-size:1.2rem}#pf__filters .pf__filter{padding-bottom:.2rem}#pf__filters .pf__check,#pf__filters .pf__radio{display:none}#pf__filters .pf__check+.pf__label,#pf__filters .pf__radio+.pf__label{cursor:pointer;font-size:1rem;display:block;margin:0}#pf__filters .pf__check+.pf__label:before,#pf__filters .pf__radio+.pf__label:before{content:'';display:inline-block;vertical-align:text-bottom;height:1.2rem;width:1.2rem;background:#fff;border:3px solid #fff;box-shadow:0 0 1px 0 #918888;margin-right:.8rem}#pf-results__wrapper{bottom:0;left:384px;overflow-y:scroll;margin:0;padding:20px}#pf-results__title{position:relative}#pf-pagination__pages{display:inline-block;float:right}#pf__results{margin-right:-15px;margin-left:-15px;padding-right:15px;padding-left:15px}#pf__pagination ul{list-style-type:none}#pf__pagination li{display:inline-block;padding:10px 5px}#pf__pagination li.active{background-color:#ddd;color:#fff}#pf__results .pf__result{width:25%;padding:30px;display:inline-block;vertical-align:top}.pf-result__image{text-align:center;font:0/0 a}.pf-result__image:before{content:'';display:inline-block;min-height:220px;vertical-align:middle}.pf-result__image img{vertical-align:middle;display:inline-block;max-width:100%;max-height:220px}.pf-result__detail{text-align:center;color:#7a7a7a;text-decoration:none}.pf-detail__vendor{font-size:.8rem}.pf-detail__title{font-size:1rem}.noUi-target{width:85%;margin:3rem auto 2rem}#pf-results__wrapper .pf__dismiss{display:none;z-index:11000}#pf-results__wrapper .pf__show-filters,#pf__filters .pf__show-results{display:none;position:fixed;bottom:0;width:100%;z-index:11000}#pf-results__wrapper .pf__show-filters button,#pf__filters .pf__show-results button{color:#fff}@media (max-width:1399px) and (min-width:769px){#pf__results .pf__result{width:33%}#pf__filters{max-width:inherit}}@media (max-width:1099px) and (min-width:769px){#pf__results .pf__result{width:50%}}@media (max-width:889px) and (min-width:768px){#pf__results .pf__result{width:100%}}@media(max-width:768px){#pf-results__wrapper{display:none;width:100%;left:0!important}#pf-results__wrapper .pf__dismiss,#pf-results__wrapper .pf__show-filters,#pf__filters .pf__show-results{display:block}#pf-results__wrapper .pf__show-filters button,#pf__filters .pf__show-results button{width:100%;margin-left:-20px;font-size:1.8rem;text-transform:uppercase;padding:.5rem}#pf__filters{width:100%;max-width:inherit;padding-bottom:4rem}#pf-pagination__pages{float:none;padding-right:4rem}}@media (max-width:660px){#pf__results .pf__result{width:50%}}
</style>
{{ 'zproducts.js' | asset_url | script_tag}}
<script type="text/javascript">
function dynamicSort(e){return function(t,n){return null===t[e]?1:null===n[e]?-1:t[e]>n[e]?1:t[e]<n[e]?-1:0}}function loadScript(e,t){var n=document.createElement("script");n.type="text/javascript",n.readyState?n.onreadystatechange=function(){"loaded"!=n.readyState&&"complete"!=n.readyState||(n.onreadystatechange=null,t())}:n.onload=function(){t()},n.src=e,document.getElementsByTagName("head")[0].appendChild(n)}function urldecode(e){return decodeURIComponent((e+"").replace(/\+/g,"%20"))}var isFirstLoad=function(e){if(void 0===e)return e={},e.firstLoad=!1,!0;var t=void 0===e.firstLoad;return e.firstLoad=!1,t};
{% for filter_group in shop.metafields.pf__g %}{% assign filter_groups = filter_groups | append: '|' | append: filter_group.last %}{% endfor %}var filter_groups = [{{ filter_groups | replace: "'","\'" | split: '|' | join: ',' | remove_first: ','}}].sort(dynamicSort('position')), {% for filter in shop.metafields.pf__f %}{% assign filters = filters | append: '|' | append: filter.last %}{% endfor %}filters = [{{ filters | replace: "'","\'" | split: '|' | join: ',' | remove_first: ','}}].sort(dynamicSort('position')), filter_settings = {% if shop.metafields.zproductfilter.settings != blank %}{% if shop.metafields.zproductfilter.settings == nil %}''{% endif %}{{ shop.metafields.zproductfilter.settings | replace: "'","\'"}}{% else %}''{% endif %}, store_currency_symbol = '{{ 100 | money_without_trailing_zeros }}'; store_currency_symbol = store_currency_symbol.slice(0, -1);
function simplifyPricing(e){for(item in e)if("object"==typeof e[item])simplifyPricing(e[item]);else if("price"==item){var t=parseInt(e[item].toString().replace(".",""),10);"undefined"!=t&&(e.simplePrice=t)}return e}function generateRangeScripts(e){var t=e.Deferred();return e.getScript("https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/9.1.0/nouislider.min.js").done(function(){e("<link/>",{rel:"stylesheet",href:"https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/9.1.0/nouislider.min.css"}).appendTo("head"),e.getScript("https://cdnjs.cloudflare.com/ajax/libs/wnumb/1.0.4/wNumb.min.js").done(function(){t.resolve("loaded scripts")})}),t.promise()}var productfilter_init=productfilter_init||{},init_product_filter=function(e){function t(){return script_tag=r.Deferred(),get_script_tag=function(e){e>15?script_tag.reject():r('script[src*="product_filter_active.js"]').length>0?script_tag.resolve():window.setTimeout(function(){get_script_tag(e+1)},200)},get_script_tag(0),script_tag.promise()}var r=e;r.when(t()).done(function(){r("#pf__toggle").find("span").text(filter_settings.button_label);for(var e=0;e<document.styleSheets.length;e++){var t=document.styleSheets[e];"pf__stylesheet"==t.title&&(t.insertRule("#pf__toggle button{background-color:"+filter_settings.primary_colour+";top:"+filter_settings.top_height+"px;"+filter_settings.position+":0px;}",t.cssRules.length),t.insertRule("#pf__toggle:hover button{background-color:"+filter_settings.secondary_colour+"}",t.cssRules.length),t.insertRule("#pf__filters .pf__check:checked+.pf__label:before,#pf__filters .pf__radio:checked+.pf__label:before{background:"+filter_settings.primary_colour+"}",t.cssRules.length),t.insertRule(".noUi-connect{background:"+filter_settings.primary_colour+"}",t.cssRules.length),t.insertRule("#pf__wrapper .pf__dismiss button{background-color:"+filter_settings.primary_colour+"}",t.cssRules.length),t.insertRule("#pf__wrapper .pf__dismiss button{background-color:"+filter_settings.primary_colour+"}",t.cssRules.length),t.insertRule("#pf__wrapper .pf__show-results button,#pf__wrapper .pf__show-filters button{background-color:"+filter_settings.primary_colour+"}",t.cssRules.length))}r("#pf__toggle").on("click",function(){r("body").addClass("pf__no-scroll"),r("#pf__wrapper").show(),r("#pf__toggle").hide()}),r(".pf__dismiss").on("click",function(){r("body").removeClass("pf__no-scroll"),r("#pf__wrapper").hide(),r("#pf__toggle").show()}),r("#pf-results__wrapper .pf__dismiss").on("click",function(){r("#pf__filters").removeAttr("style"),r("#pf-results__wrapper").removeAttr("style")}),r(".pf__show-results").on("click",function(){r("#pf-results__wrapper").show(),r("#pf__filters").hide()}),r(".pf__show-filters").on("click",function(){r("#pf__filters").show(),r("#pf-results__wrapper").hide()}),r(window).on("resize",function(){r("#pf__filters").removeAttr("style"),r("#pf-results__wrapper").removeAttr("style")});var i=r("#pf__filters");loaded={},filter_groups.length>0?r(filter_groups).each(function(e,t){if(t.visible||0!=t.visible){switch(t.filter_type){case"tags":case"vendor":html=r("#pf-template__section").html();var l=r(html,{html:html});l.find(".pf__group-title").text(urldecode(t.name)).end().attr("data-id",t.id).attr("id","filter-group-"+t.id).end(),r(i).append(l);break;case"price_range":html=r("#pf-template__section").html();var l=r(html,{html:html});l.find(".pf__group-title").text(urldecode(t.name)).end().attr("data-id",t.id).attr("id","filter-group-"+t.id).end(),r(i).append(l),html=r("#pf-template__range").html();var l=r(html,{html:html}),n=r(".pf__section[data-id="+t.id+"]");n.append(l),generateRangeScripts(r).done(function(){generateRange(r("#filter-group-"+t.id))})}filter_groups[e].included=!0}e===filter_groups.length-1&&(loaded.filter_groups=!0)}):loaded.filter_groups=!0,filters.length>0?r(filters).each(function(e,t){if(t.visible||0!=t.visible){html=r("#pf-template__check").html();var i=r(html,{html:html});i.find(".pf__label").text(urldecode(t.name)).attr("for","filter_"+t.id),r(t.value).each(function(e,r){i.find(".pf__check").attr("id","filter_"+t.id).val(function(e,t){return""==t?urldecode(r):t+","+urldecode(r)})});var l=r(".pf__section[data-id="+t.parent+"]");l.append(i),filters[e].included=!0}e===filters.length-1&&(loaded.filters=!0,filters_ready(r))}):(loaded.filters=!0,filters_ready(r))})},priceEncode=function(e){return e=e.toFixed(),e<10?calculated_value=parseInt("0.0"+e):e<100?calculated_value=parseFloat("0."+e):(numeral=e.substring(0,e.length-2),decimal=e.substring(e.length-2,e.length),calculated_value=parseFloat(numeral+"."+decimal)),calculated_value},generateRange=function(e){var t=e,r=1e3*Math.ceil(zFilterMaxPrice/10),i=t.find(".pf__range").get(0);noUiSlider.create(i,{connect:!0,start:[0,r],range:{min:0,max:r},tooltips:[wNumb({decimals:2,prefix:store_currency_symbol,encoder:function(e){return priceEncode(e)}}),wNumb({decimals:2,prefix:store_currency_symbol,encoder:function(e){return priceEncode(e)}})],format:wNumb({decimals:0}),pips:{mode:"positions",values:[0,100],density:4,format:wNumb({decimals:0,prefix:store_currency_symbol,encoder:function(e){return priceEncode(e)}})}}),i.noUiSlider.on("update",function(e,r){t.find(".pf-range__input").val(e[0]+"-"+e[1]).trigger("click")})},hoverFilter=function(e){if(isFirstLoad(productfilter_init)){try{if(null==filter_settings||!filter_settings.enabled||0==filter_settings.enabled){var t=document.getElementById("pf__toggle"),r=document.getElementById("pf__wrapper");return t.outerHTML="",void(r.outerHTML="")}}catch(i){return}if("undefined"==typeof e||null==e)loadScript("https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.3/jquery.min.js",function(){var e=jQuery.noConflict(!0);init_product_filter(e)});else{var l=e.fn.jquery.split(".");l[0]>1||1==l[0]&&l[1]>8?init_product_filter(e):loadScript("https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.3/jquery.min.js",function(){var e=jQuery.noConflict(!0);init_product_filter(e)})}}},launchFilter=function(e){var t=simplifyPricing(zFilterProducts),r=FilterJS(t,"#pf__results",{template:"#pf-template__result",search:{ele:".pf__search-input",fields:["title","vendor","handle","tags"]},pagination:{container:"#pf__pagination",visiblePages:5,perPage:{values:[32,64,128],container:"#pf-pagination__pages"}},callbacks:{beforeRender:function(t){e("#pf-results__title h1 small span").text(t.length),e("#pf__filters .pf__show-results span").text(t.length)}}});window.FJS=r,r.addCallback("afterAddRecords",function(t){r.paginator.perPageCount>=t.length?e("#pf__pagination").hide():e("#pf__pagination").show()}),r.addCallback("afterFilter",function(t){e("#pf-results__title h1 small span").text(t.length),e("#pf__filters .pf__show-results span").text(t.length),r.paginator.perPageCount>=t.length?e("#pf__pagination").hide():e("#pf__pagination").show()}),e(filter_groups).each(function(e,t){if(t.included)switch(t.filter_type){case"tags":r.addCriteria({field:"tags",ele:"#filter-group-"+t.id+" .pf__check",delimiter:",",multiples:"1"});break;case"vendor":r.addCriteria({field:"vendor",ele:"#filter-group-"+t.id+" .pf__check"});break;case"price_range":r.addCriteria({field:"variants.simplePrice",ele:"#filter-group-"+t.id+" .pf-range__input",type:"range",event:"click"})}})},filters_ready=function(e){loaded.filters&&loaded.filter_groups?loadScript("https://zyberlabs.s3.amazonaws.com/productfilter/filter.js",function(){launchFilter(e)}):setTimeout(function(){filters_ready(e)},250)};hoverFilter("undefined"==typeof $?null:$);
</script>